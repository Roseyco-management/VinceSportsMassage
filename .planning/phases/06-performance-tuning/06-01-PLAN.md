---
phase: 06-performance-tuning
plan: 01
type: execute
---

<objective>
Configure Next.js performance optimizations and evaluate Framer Motion bundle impact.

Purpose: Improve page load performance, Core Web Vitals, and overall user experience through proper Next.js configuration and bundle optimization.
Output: Enhanced next.config.ts with compression and optimization settings, documented Framer Motion evaluation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STACK.md
@.planning/codebase/CONVENTIONS.md

# Relevant files for performance work
@next.config.ts
@package.json

# Prior summaries (context inheritance)
@.planning/phases/05-seo-optimization/05-01-SUMMARY.md

**Tech stack available:**
- Next.js 16 with App Router and Turbopack
- Framer Motion 12.23.25 for animations
- Existing image optimization (remotePatterns already configured in Phase 5)

**Established patterns:**
- Next.js Image optimization with Supabase remotePatterns (Phase 5)
- Build-time static generation where possible

**Constraining decisions:**
- IMAGE OPTIMIZATION ALREADY COMPLETE: Phase 5 added remotePatterns for Supabase Storage
- Keep Framer Motion (PROJECT.md decision: bundle size acceptable for animation quality)
- Maintain existing visual design and animations
- Work within Vercel deployment constraints
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add compression and optimization settings to Next.js config</name>
  <files>next.config.ts</files>
  <action>Add performance optimization settings to next.config.ts:

  **Add to the NextConfig object:**

  1. **Compiler optimizations:**
     ```typescript
     compiler: {
       removeConsole: process.env.NODE_ENV === "production" ? {
         exclude: ["error", "warn"],
       } : false,
     }
     ```
     This removes console.log statements in production (keeps error/warn for debugging), reducing bundle size and improving performance.

  2. **Experimental optimizations (if using Vercel):**
     ```typescript
     experimental: {
       optimizePackageImports: ["lucide-react", "framer-motion"],
     }
     ```
     This enables tree-shaking for large icon libraries and Framer Motion, importing only what's used.

  Do NOT add compression settings (Vercel handles compression automatically with Brotli/Gzip).
  Do NOT add turbo config (already using Turbopack by default in Next.js 16).
  Keep existing images.remotePatterns from Phase 5 unchanged.

  Follow Next.js 16 TypeScript conventions and maintain code formatting consistency.</action>
  <verify>Build succeeds with `npm run build`, no TypeScript errors. Check build output for optimizations applied.</verify>
  <done>next.config.ts includes compiler.removeConsole and experimental.optimizePackageImports. Build passes without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Evaluate and document Framer Motion bundle impact</name>
  <files>.planning/phases/06-performance-tuning/FRAMER-MOTION-EVALUATION.md</files>
  <action>Create a documentation file evaluating Framer Motion's bundle impact and decision rationale.

  **Research and document:**

  1. **Current usage analysis:**
     - Count Framer Motion imports across codebase: `grep -r "framer-motion" src --include="*.tsx" | wc -l`
     - Identify which components use motion (Hero, sections with scroll animations, etc.)
     - Note animation patterns (scroll-triggered, stagger, hover effects)

  2. **Bundle impact:**
     - Framer Motion: ~40KB gzipped (from PROJECT.md context)
     - Check package.json to confirm version (^12.23.25)
     - Note that experimental.optimizePackageImports from Task 1 enables tree-shaking

  3. **Decision rationale** (from PROJECT.md Key Decisions):
     - PROJECT.md states: "Keep Framer Motion (no dynamic import) - Bundle size impact acceptable for animation quality, premature optimization to remove"
     - Animations are core to the brand experience (smooth scroll effects, professional feel)
     - No alternative provides the same DX and animation quality
     - Tree-shaking with optimizePackageImports reduces actual bundle impact

  4. **Recommendation:**
     - **DECISION: Keep Framer Motion** (already decided in PROJECT.md)
     - Document that bundle size (~40KB gzipped) is acceptable given:
       * Animations are brand-differentiating (premium massage service positioning)
       * Excellent Core Web Vitals can still be achieved with this bundle size
       * Tree-shaking via experimental.optimizePackageImports reduces impact
       * Removing would require complete animation rewrite with inferior results

  Create `.planning/phases/06-performance-tuning/FRAMER-MOTION-EVALUATION.md` with sections:
  - **Current Usage** (component count, animation patterns)
  - **Bundle Impact** (size, optimization applied)
  - **Decision Rationale** (why keeping it makes sense)
  - **Recommendation** (Keep Framer Motion)

  This is documentation only - no code changes needed for Framer Motion.</action>
  <verify>FRAMER-MOTION-EVALUATION.md exists with all sections completed. Decision clearly states "Keep Framer Motion" with rationale.</verify>
  <done>Evaluation document created with usage analysis, bundle impact assessment, and keep decision documented with rationale.</done>
</task>

<task type="auto">
  <name>Task 3: Verify performance optimizations applied</name>
  <files>None (verification only)</files>
  <action>Verify that all performance optimizations are working correctly:

  1. **Build verification:**
     - Run `npm run build`
     - Confirm build succeeds without errors
     - Check that optimizations are applied (tree-shaking messages in build output)

  2. **Configuration verification:**
     - Confirm next.config.ts has compiler.removeConsole (production only)
     - Confirm next.config.ts has experimental.optimizePackageImports
     - Confirm images.remotePatterns still present from Phase 5

  3. **Bundle verification:**
     - Check that build output shows route optimization (○ for static, ● for SSG)
     - Verify no new warnings or errors introduced

  This is a verification-only task - no file modifications needed. Just run checks and confirm everything works.</action>
  <verify>npm run build succeeds, all routes build correctly, no new errors or warnings introduced by config changes.</verify>
  <done>Build succeeds with optimizations applied, all routes functioning, no regressions introduced.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] next.config.ts includes performance optimizations
- [ ] Framer Motion evaluation document created with keep decision
- [ ] No regressions in build output or route generation
- [ ] All existing functionality preserved
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- Performance optimizations configured (removeConsole, optimizePackageImports)
- Framer Motion evaluation documented with keep decision
- Image optimization from Phase 5 preserved
- Build output confirms optimizations applied
  </success_criteria>

<output>
After completion, create `.planning/phases/06-performance-tuning/06-01-SUMMARY.md`:

---
phase: 06-performance-tuning
plan: 01
subsystem: performance
tags: [next.js, optimization, bundle, compression, framer-motion]

# Dependency graph
requires:
  - phase: 05-seo-optimization
    provides: Image optimization with remotePatterns, Next.js configuration foundation
provides:
  - Next.js compiler optimizations (removeConsole in production)
  - Package import optimizations (tree-shaking for lucide-react, framer-motion)
  - Framer Motion bundle evaluation and keep decision
affects: [07-type-safety-enhancement, future-performance-work]

# Tech tracking
tech-stack:
  added: []
  patterns: [nextjs-compiler-optimization, tree-shaking-optimization]

key-files:
  modified: [next.config.ts]
  created: [.planning/phases/06-performance-tuning/FRAMER-MOTION-EVALUATION.md]

key-decisions:
  - "Framer Motion kept (bundle impact acceptable for animation quality)"
  - "Console removal in production only (preserve error/warn for debugging)"
  - "Package import optimization for lucide-react and framer-motion"

# Phase [6] Plan [1]: Performance Tuning Summary

**Next.js compiler and package optimizations configured, Framer Motion evaluation confirms keep decision**

## Accomplishments

- Added compiler optimizations to remove console.log in production (preserves error/warn)
- Configured experimental package import optimization for tree-shaking
- Evaluated Framer Motion bundle impact (~40KB gzipped)
- Documented decision to keep Framer Motion (animations core to brand, bundle acceptable)
- Preserved image optimization from Phase 5

## Files Created/Modified

- `next.config.ts` - Added compiler.removeConsole and experimental.optimizePackageImports
- `.planning/phases/06-performance-tuning/FRAMER-MOTION-EVALUATION.md` - Bundle evaluation and keep decision

## Decisions Made

- **Keep Framer Motion**: Bundle size (~40KB gzipped) acceptable given animation quality and brand differentiation
- **Production console removal**: Removes console.log in production but keeps error/warn for debugging
- **Package import optimization**: Enables tree-shaking for lucide-react and framer-motion to reduce actual bundle size

## Issues Encountered

None.

## Next Phase Readiness

Phase complete. Ready for Phase 7: Type Safety Enhancement.

**Note for Phase 7**: Performance foundation in place. Phase 7 can focus on TypeScript interfaces for API payloads and removing non-null assertions.
</output>
