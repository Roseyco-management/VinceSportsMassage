---
phase: 05-seo-optimization
plan: 01
type: execute
---

<objective>
Complete SEO optimization by adding missing meta tags, improving sitemap generation, and implementing Next.js Image optimization for blog posts.

Purpose: Improve search engine discoverability, social sharing, and page load performance through proper SEO configuration and image optimization.
Output: Meta tags added to layout, dynamic sitemap generation from Supabase, Next.js Image configuration with blog image optimization.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STACK.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/CONVENTIONS.md

# Relevant files for SEO work
@src/app/layout.tsx
@src/app/sitemap.ts
@src/app/robots.ts
@next.config.ts

# Prior summaries (context inheritance)
@.planning/phases/01-critical-security-hardening/01-01-SUMMARY.md
@.planning/phases/02-input-validation-error-handling/02-01-SUMMARY.md
@.planning/phases/03-environment-configuration-management/03-01-SUMMARY.md
@.planning/phases/04-accessibility-remediation/04-01-SUMMARY.md

**Tech stack available:**
- Next.js 16 with App Router (built-in Image component, metadata API)
- Supabase client for database queries
- TypeScript with strict mode
- Environment validation pattern established in Phase 3

**Established patterns:**
- Server Component sanitization (Phase 1)
- Centralized environment validation with Zod (Phase 3)
- Structured logging for errors (Phase 2)

**Constraining decisions:**
- Use Next.js built-in features (no external SEO libraries)
- Maintain existing metadata structure in layout.tsx
- Follow existing file naming conventions (kebab-case)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing meta tags to root layout</name>
  <files>src/app/layout.tsx</files>
  <action>Add three missing meta tags to the metadata object in layout.tsx:

  1. **Twitter verification meta tag** - Add to metadata object under a new `verification` property (Next.js metadata API pattern). Use `NEXT_PUBLIC_TWITTER_SITE_VERIFICATION` environment variable (optional).

  2. **Google verification meta tag** - Add to metadata object under the same `verification` property. Use `NEXT_PUBLIC_GOOGLE_SITE_VERIFICATION` environment variable (optional).

  3. **Theme color meta tag** - Add `themeColor` property to metadata object. Use the primary brand color from the design system (check existing Tailwind config or use slate-900 for consistency with header).

  Follow Next.js 16 metadata API conventions (not legacy <meta> tags). Reference: https://nextjs.org/docs/app/api-reference/functions/generate-metadata

  Do NOT add these environment variables to src/lib/env.ts - they are truly optional and should use process.env directly with undefined fallback (no validation needed for optional meta tags).</action>
  <verify>Build succeeds with `npm run build`, no TypeScript errors. Inspect generated HTML to confirm meta tags present in <head>.</verify>
  <done>Metadata object includes verification (twitter, google) and themeColor properties. Build passes without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Implement dynamic sitemap generation from Supabase</name>
  <files>src/app/sitemap.ts</files>
  <action>Replace hardcoded blogSlugs array with dynamic fetch from Supabase blog_posts table:

  1. Import createClient from `@/lib/supabase/server`
  2. Query blog_posts table for published posts: `.select('slug, updated_at').eq('status', 'published')`
  3. Handle error gracefully - if query fails, log error with structured logger and fall back to empty array (don't fail sitemap generation)
  4. Map results to sitemap format with actual lastModified dates from updated_at column
  5. Keep existing staticPaths array unchanged

  Pattern: async function sitemap() - Next.js allows async sitemap functions. Use try-catch for Supabase query.

  Do NOT remove commented note about placeholder slugs - replace it with note that sitemap now fetches from Supabase.</action>
  <verify>Run `npm run build` and check that .next output includes sitemap.xml. Visit http://localhost:3000/sitemap.xml in dev mode to confirm dynamic generation works.</verify>
  <done>Sitemap fetches blog posts from Supabase, includes all published posts with accurate lastModified dates, falls back gracefully on error.</done>
</task>

<task type="auto">
  <name>Task 3: Configure Next.js Image optimization for blog images</name>
  <files>next.config.ts, src/app/(marketing)/blog/[slug]/blog-post-page.tsx</files>
  <action>Configure Next.js Image component for blog post featured images:

  **Step 1 - Configure next.config.ts:**
  Add images configuration with remotePatterns for Supabase Storage:
  ```typescript
  const nextConfig: NextConfig = {
    images: {
      remotePatterns: [
        {
          protocol: 'https',
          hostname: '*.supabase.co',
          pathname: '/storage/v1/object/public/**',
        },
      ],
    },
  }
  ```

  **Step 2 - Update blog-post-page.tsx:**
  Replace the placeholder emoji div (lines 122-126) with Next.js Image component:
  - Import Image from 'next/image'
  - Add optional `featured_image_url?: string` to BlogPostPageProps interface
  - Conditionally render Image component if featured_image_url exists, otherwise keep placeholder
  - Image props: src={post.featured_image_url}, alt={post.title}, fill={true}, className="object-cover", sizes="(max-width: 1024px) 100vw, 896px"
  - Use priority={true} for above-the-fold LCP optimization

  Keep the placeholder emoji as fallback for posts without images. Do NOT modify the dangerouslySetInnerHTML content rendering (that's already sanitized in Phase 1).</action>
  <verify>Build succeeds. In dev mode, blog posts without featured_image_url show placeholder, posts with featured_image_url would use optimized Image component (no posts currently have images, so verify code structure only).</verify>
  <done>next.config.ts includes remotePatterns for Supabase. blog-post-page.tsx uses Next.js Image component when featured_image_url present, falls back to placeholder otherwise. TypeScript types updated.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes with no new warnings
- [ ] Sitemap generates at /sitemap.xml with blog posts from database
- [ ] Meta tags visible in page source <head>
- [ ] next.config.ts includes image optimization config
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- Meta tags follow Next.js 16 metadata API conventions
- Sitemap dynamically fetches from Supabase with error handling
- Image optimization configured for future blog images
- Placeholder remains functional for posts without images
  </success_criteria>

<output>
After completion, create `.planning/phases/05-seo-optimization/05-01-SUMMARY.md`:

---
phase: 05-seo-optimization
plan: 01
subsystem: seo
tags: [meta-tags, sitemap, image-optimization, next.js, supabase]

# Dependency graph
requires:
  - phase: 04-accessibility-remediation
    provides: Component accessibility patterns, environment config foundation
provides:
  - Complete meta tag configuration (verification tags, theme color)
  - Dynamic sitemap generation from Supabase
  - Next.js Image optimization configured for blog images
affects: [06-performance-tuning, future-seo-work]

# Tech tracking
tech-stack:
  added: []
  patterns: [nextjs-metadata-api, dynamic-sitemap-generation, nextjs-image-optimization]

key-files:
  modified: [src/app/layout.tsx, src/app/sitemap.ts, next.config.ts, src/app/(marketing)/blog/[slug]/blog-post-page.tsx]

key-decisions:
  - "Meta tags use Next.js metadata API (not legacy <meta> tags)"
  - "Sitemap fetches from Supabase with graceful error fallback"
  - "Image optimization configured but preserves placeholder for posts without images"

# Phase [5] Plan [1]: SEO Optimization Summary

**Complete meta tags, dynamic sitemap generation, and Next.js Image optimization configured for blog posts.**

## Accomplishments

- Added verification meta tags (Twitter, Google) and theme color to root layout using Next.js metadata API
- Implemented dynamic sitemap generation that fetches published blog posts from Supabase
- Configured Next.js Image component with remotePatterns for Supabase Storage
- Updated blog post page to use Next.js Image for featured images with LCP optimization
- Maintained placeholder fallback for posts without featured images

## Files Created/Modified

- `src/app/layout.tsx` - Added verification and themeColor to metadata object
- `src/app/sitemap.ts` - Replaced hardcoded slugs with dynamic Supabase query
- `next.config.ts` - Added images.remotePatterns configuration for Supabase
- `src/app/(marketing)/blog/[slug]/blog-post-page.tsx` - Integrated Next.js Image component with conditional rendering

## Decisions Made

- **Next.js metadata API over legacy tags**: Used built-in metadata object instead of manual <meta> tags for better type safety and SSR support
- **Graceful sitemap fallback**: Sitemap generation logs errors but doesn't fail if Supabase query fails (empty blog array)
- **Optional featured images**: Preserved placeholder emoji for posts without images rather than requiring images (backward compatible)
- **LCP optimization**: Used priority={true} on featured images since they're above-the-fold content

## Issues Encountered

None.

## Next Phase Readiness

Phase complete. Ready for Phase 6: Performance Tuning.

**Note for Phase 6**: Image optimization config is now in place. Phase 6 can focus on compression settings, bundle analysis (Framer Motion evaluation), and general Next.js performance tuning.
</output>
