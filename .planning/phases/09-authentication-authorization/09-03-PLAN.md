---
phase: 09-authentication-authorization
plan: 03
type: execute
---

<objective>
Build the admin dashboard shell with layout, navigation, logout functionality, and placeholder homepage.

Purpose: Create the authenticated admin area structure that all admin features (blog management, analytics, testimonials) will plug into. This establishes the UI framework and user experience patterns for the admin dashboard.
Output: Protected /admin route with layout, header, navigation, logout button, and welcome dashboard displaying user info.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-authentication-authorization/09-01-SUMMARY.md
@.planning/phases/09-authentication-authorization/09-02-SUMMARY.md
@src/lib/auth/session.ts
@src/lib/auth/roles.ts
@src/middleware.ts
@src/components/layout/header.tsx

**Available from Plans 1-2:**
- requireAdmin() utility for layout protection
- getUser() to fetch current user details
- Middleware protecting /admin routes
- Working login page at /login

**UI patterns to follow:**
- Marketing site header pattern (src/components/layout/header.tsx)
- shadcn/ui components for consistency
- Responsive design (mobile, tablet, desktop)
- Tailwind CSS utilities

**Future admin features** (show as placeholders):
- Blog Management (Phase 10)
- Automation & Logs (Phase 11)
- Analytics Dashboard (Phase 12)
- Testimonial Management (Phase 13)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin layout with authentication guard</name>
  <files>src/app/admin/layout.tsx</files>
  <action>
Create admin layout that wraps all /admin routes:

**src/app/admin/layout.tsx** (Server Component):
- Import requireAdmin from "@/lib/auth/roles"
- Import AdminHeader from "@/components/admin/header"
- Import type Metadata from "next"

Export metadata:
```typescript
export const metadata: Metadata = {
  title: "Admin Dashboard | Vince Sports Massage",
  description: "Admin dashboard for content and analytics management",
  robots: "noindex, nofollow" // Don't index admin pages
}
```

Default export async layout function:
1. Call await requireAdmin() at top - this throws if not authenticated/admin, preventing render
2. Render structure:
   ```tsx
   <div className="min-h-screen bg-slate-50">
     <AdminHeader />
     <main className="container mx-auto px-4 py-8">
       {children}
     </main>
   </div>
   ```
3. Use Tailwind classes matching existing site patterns

The requireAdmin() call provides "defense in depth" - middleware already checked, but layout double-checks before rendering any admin content.

AVOID: Don't use client-side auth checks (use server requireAdmin()). Don't duplicate the marketing header (AdminHeader is separate). Don't fetch user in layout (let children fetch as needed).
  </action>
  <verify>File exists, exports metadata and default function, TypeScript validates</verify>
  <done>Layout guards admin routes with requireAdmin(), renders AdminHeader and children, proper types</done>
</task>

<task type="auto">
  <name>Task 2: Create admin header with navigation and logout</name>
  <files>src/components/admin/header.tsx, src/app/admin/actions.ts</files>
  <action>
Create admin header and logout action:

**src/components/admin/header.tsx** (Client Component):
- "use client" directive
- Import { Button } from "@/components/ui/button"
- Import { LogOut, LayoutDashboard } from "lucide-react"
- Import { logoutAction } from "@/app/admin/actions"
- Import Link from "next/link"

Component structure:
```tsx
export function AdminHeader() {
  const handleLogout = async () => {
    await logoutAction()
    // Redirect happens in server action
  }

  return (
    <header className="border-b bg-white">
      <div className="container mx-auto px-4 py-4 flex items-center justify-between">
        <Link href="/admin" className="flex items-center gap-2">
          <LayoutDashboard className="h-6 w-6 text-cyan-600" />
          <span className="font-semibold text-lg">Admin Dashboard</span>
        </Link>
        <Button onClick={handleLogout} variant="outline" size="sm">
          <LogOut className="h-4 w-4 mr-2" />
          Sign Out
        </Button>
      </div>
    </header>
  )
}
```

Match styling from marketing header (border-b, bg-white, container pattern).

**src/app/admin/actions.ts:**
- "use server" directive
- Import createClient from "@/lib/supabase/server"
- Import redirect from "next/navigation"
- Import logger from "@/lib/logger"

Export async logoutAction():
1. Create server Supabase client
2. Call await supabase.auth.signOut()
3. Log the logout event: logger.info("Admin logged out")
4. Call redirect("/") to send user to homepage
5. Wrap in try-catch, redirect to "/" even if error (fail-safe logout)

AVOID: Don't use client-side signOut (cookies won't clear properly). Don't forget to redirect after logout. Don't show user email in header (keep it minimal - it's shown on dashboard page).
  </action>
  <verify>Files exist, header renders with logout button, TypeScript validates, no import errors</verify>
  <done>AdminHeader component created, logoutAction works, button triggers server action, proper styling</done>
</task>

<task type="auto">
  <name>Task 3: Create admin dashboard homepage with user info and feature placeholders</name>
  <files>src/app/admin/page.tsx</files>
  <action>
Create admin dashboard homepage:

**src/app/admin/page.tsx** (Server Component):
- Import getUser from "@/lib/auth/session"
- Import { Card, CardHeader, CardTitle, CardDescription, CardContent } from "@/components/ui/card"
- Import { FileText, Activity, BarChart, MessageSquare } from "lucide-react"

Default export async page component:
1. Call const user = await getUser() to get current user
2. Render dashboard structure:
   - Welcome section with user email: "Welcome, {user.email}"
   - Grid of feature cards (4 cards, 2x2 grid on desktop, 1 column on mobile)

Feature cards (use same structure for all):
```tsx
<Card className="opacity-50 cursor-not-allowed">
  <CardHeader>
    <CardTitle className="flex items-center gap-2">
      <FileText className="h-5 w-5 text-cyan-600" />
      Blog Management
    </CardTitle>
    <CardDescription>Create and manage blog posts</CardDescription>
  </CardHeader>
  <CardContent>
    <p className="text-sm text-muted-foreground">Coming in Phase 10</p>
  </CardContent>
</Card>
```

Four cards:
1. Blog Management (FileText icon) - "Coming in Phase 10"
2. Automation & Logs (Activity icon) - "Coming in Phase 11"
3. Analytics Dashboard (BarChart icon) - "Coming in Phase 12"
4. Testimonial Management (MessageSquare icon) - "Coming in Phase 13"

Use Tailwind grid: `grid grid-cols-1 md:grid-cols-2 gap-6`

Styling matches existing marketing site patterns (cyan accent, slate gray text).

AVOID: Don't make cards clickable yet (they're placeholders). Don't fetch blog/analytics data (future phases). Don't over-complicate - this is a simple dashboard shell.
  </action>
  <verify>Visit /admin after login shows welcome message and 4 placeholder cards, TypeScript validates</verify>
  <done>Dashboard renders, shows user email, displays 4 feature placeholders, responsive grid layout</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete admin dashboard shell with layout, header, navigation, and logout</what-built>
  <how-to-verify>
    1. Run: npm run dev (if not running)
    2. Visit: http://localhost:3000/admin (should redirect to /login if not logged in)
    3. Login with admin credentials from Plan 1
    4. Verify: Redirected to /admin dashboard
    5. Verify: Header shows "Admin Dashboard" branding and "Sign Out" button
    6. Verify: Dashboard shows "Welcome, [your email]"
    7. Verify: 4 feature cards displayed in grid (Blog, Automation, Analytics, Testimonials)
    8. Verify: Cards show "Coming in Phase X" placeholder text
    9. Click "Sign Out" button
    10. Verify: Redirected to / (homepage)
    11. Try to visit /admin again: Should redirect back to /login
    12. Open in incognito window, try /admin: Should redirect to /login immediately (middleware working)
    13. Check responsive design: Resize browser - cards should stack on mobile, 2x2 on desktop
  </how-to-verify>
  <resume-signal>Type "approved" when all checks pass, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Admin layout guards routes with requireAdmin()
- [ ] AdminHeader renders with logout button
- [ ] Logout action works (clears session, redirects to /)
- [ ] Dashboard shows welcome message with user email
- [ ] 4 placeholder feature cards displayed
- [ ] Responsive layout works on mobile and desktop
- [ ] No TypeScript errors: npm run build succeeds
- [ ] Marketing site unaffected (/ routes still work)
- [ ] Full auth flow: visit /admin → redirect to /login → login → dashboard → logout → homepage
</verification>

<success_criteria>

- All tasks completed
- Admin dashboard accessible only after authentication
- Layout provides consistent structure for future features
- Header navigation and logout work correctly
- Dashboard displays user context and feature roadmap
- No console errors or TypeScript issues
- Phase 9 complete - authentication foundation ready for Phase 10 (Blog Management)
  </success_criteria>

<output>
After completion, create `.planning/phases/09-authentication-authorization/09-03-SUMMARY.md`:

---
phase: 09-authentication-authorization
plan: 03
type: execute
subsystem: admin-shell
requires: [9, 9]
provides: ["admin-layout", "admin-header", "admin-dashboard", "logout-flow"]
affects: [10, 11, 12, 13, 14]
tech-stack:
  added: ["Admin layout pattern", "Admin header component", "Dashboard shell"]
  patterns: ["Layout-level auth guard", "Client header with server actions", "Placeholder-driven development for future features"]
key-decisions:
  - "Separate admin header from marketing header (distinct branding)"
  - "Layout calls requireAdmin() for defense-in-depth (middleware + layout verification)"
  - "Logout is server action (not client-side) for proper session cleanup"
  - "Dashboard shows feature roadmap as placeholders (sets user expectations)"
key-files:
  - "src/app/admin/layout.tsx"
  - "src/app/admin/page.tsx"
  - "src/app/admin/actions.ts"
  - "src/components/admin/header.tsx"
patterns-established:
  - "Admin layout as container for all admin features"
  - "Server actions file per route for auth operations"
  - "Placeholder cards showing future feature roadmap"
---

# Phase 9 Plan 3: Admin Dashboard Shell Summary

**[One-liner about what shipped]**

## Accomplishments

- [List key achievements]

## Files Created/Modified

- [File paths with descriptions]

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

**Phase 9 Complete!** All three plans executed successfully:
- Plan 1: Database schema and auth utilities ✓
- Plan 2: Login UI and authentication flow ✓
- Plan 3: Admin dashboard shell with layout ✓

Phase 10 (Blog Management UI) can begin immediately. Admin dashboard structure ready:
- requireAdmin() guard pattern established for protected components
- Admin layout provides consistent UI container
- Users authenticated and ready to manage content
- Dashboard shows clear roadmap for upcoming features
</output>
